<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SIMRI3D: dcmread.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>dcmread.c</h1><a href="dcmread_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">* $Id: dcmread.c,v 1.2 2005/09/09 08:52:37 bellet Exp $</span>
00003 <span class="comment">**************************************************************************</span>
00004 <span class="comment"> This software is governed by the CeCILL  license under French law and</span>
00005 <span class="comment">  abiding by the rules of distribution of free software.  You can  use, </span>
00006 <span class="comment">  modify and/ or redistribute the software under the terms of the CeCILL</span>
00007 <span class="comment">  license as circulated by CEA, CNRS and INRIA at the following URL</span>
00008 <span class="comment">  "http://www.cecill.info". </span>
00009 <span class="comment">  </span>
00010 <span class="comment">  As a counterpart to the access to the source code and  rights to copy,</span>
00011 <span class="comment">  modify and redistribute granted by the license, users are provided only</span>
00012 <span class="comment">  with a limited warranty  and the software's author,  the holder of the</span>
00013 <span class="comment">  economic rights,  and the successive licensors  have only  limited</span>
00014 <span class="comment">  liability. </span>
00015 <span class="comment">  </span>
00016 <span class="comment">  In this respect, the user's attention is drawn to the risks associated</span>
00017 <span class="comment">  with loading,  using,  modifying and/or developing or reproducing the</span>
00018 <span class="comment">  software by the user in light of its specific status of free software,</span>
00019 <span class="comment">  that may mean  that it is complicated to manipulate,  and  that  also</span>
00020 <span class="comment">  therefore means  that it is reserved for developers  and  experienced</span>
00021 <span class="comment">  professionals having in-depth computer knowledge. Users are therefore</span>
00022 <span class="comment">  encouraged to load and test the software's suitability as regards their</span>
00023 <span class="comment">  requirements in conditions enabling the security of their systems and/or </span>
00024 <span class="comment">  data to be ensured and,  more generally, to use and operate it in the </span>
00025 <span class="comment">  same conditions as regards security. </span>
00026 <span class="comment">  </span>
00027 <span class="comment">  The fact that you are presently reading this means that you have had</span>
00028 <span class="comment">  knowledge of the CeCILL license and that you accept its terms.</span>
00029 <span class="comment">  </span>
00030 <span class="comment">  Copyright (c) CREATIS (Centre de Recherche et d'Applications en Traitement de</span>
00031 <span class="comment">  l'Image). All rights reserved. See License.txt for details.</span>
00032 <span class="comment">  </span>
00033 <span class="comment">  Version 1.0  05/09/2005</span>
00034 <span class="comment">*************************************************************************/</span>
00035 
00036 <span class="comment">/*</span>
00037 <span class="comment">**************************************************************************</span>
00038 <span class="comment">*</span>
00039 <span class="comment">*  Description : Lit un objet LIBIDO dans un fichier </span>
00040 <span class="comment">*     au format ACR-NEMA,LibIDO,DICOM</span>
00041 <span class="comment">**************************************************************************</span>
00042 <span class="comment">*/</span>
00043 
00044 <span class="preprocessor">#include &lt;string.h&gt;</span>  <span class="comment">// For strlen</span>
00045 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00046 <span class="preprocessor">#include "<a class="code" href="idio_8h.html">idio.h</a>"</span>
00047 <span class="comment">//#include &lt;idprint.h&gt;</span>
00048 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00049 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>  <span class="comment">// For atoi</span>
00050 <span class="preprocessor">#include "<a class="code" href="idgen_8h.html">idgen.h</a>"</span>
00051 
00052 <span class="preprocessor">#include "<a class="code" href="idsig_8h.html">idsig.h</a>"</span>
00053 <span class="preprocessor">#include "<a class="code" href="idcnt_8h.html">idcnt.h</a>"</span>
00054 <span class="preprocessor">#include "<a class="code" href="idima_8h.html">idima.h</a>"</span>
00055 <span class="preprocessor">#include "<a class="code" href="idvol_8h.html">idvol.h</a>"</span>
00056 <span class="preprocessor">#include "<a class="code" href="idseq_8h.html">idseq.h</a>"</span>
00057 
00058 <span class="preprocessor">#include "<a class="code" href="iderr_8h.html">iderr.h</a>"</span>
00059 
00060 <span class="preprocessor">#include "<a class="code" href="iddcm-restricted_8h.html">iddcm-restricted.h</a>"</span>
00061 <span class="preprocessor">#include "<a class="code" href="iddcmjpeg_8h.html">iddcmjpeg.h</a>"</span>
00062 
<a name="l00063"></a><a class="code" href="dcmread_8c.html#a0">00063</a> <span class="preprocessor">#define DEBUG 0</span>
00064 <span class="preprocessor"></span>
00065 <span class="keyword">static</span> <span class="keywordtype">void</span> _Swap(<span class="keywordtype">void</span>* , <span class="keywordtype">int</span> , <span class="keywordtype">int</span> , <span class="keywordtype">int</span> );
00066 
00067 
00068 <span class="comment">/* </span>
00069 <span class="comment">Rappels</span>
00070 <span class="comment">-------</span>
00071 <span class="comment">     </span>
00072 <span class="comment">#define TY_CHAR           ( 0&lt;&lt;4)  00</span>
00073 <span class="comment">#define TY_FLOAT       ( 1&lt;&lt;4)  10</span>
00074 <span class="comment">#define TY_DOUBLE      ( 2&lt;&lt;4)  20</span>
00075 <span class="comment">#define TY_COMPLEX        ( 3&lt;&lt;4)  30</span>
00076 <span class="comment">#define TY_RGB         ( 4&lt;&lt;4)  40</span>
00077 <span class="comment">#define TY_SHORT       ( 5&lt;&lt;4)  50</span>
00078 <span class="comment">#define TY_LONG           ( 6&lt;&lt;4)  60</span>
00079 <span class="comment">#define TY_UCHAR       ( 7&lt;&lt;4)  70</span>
00080 <span class="comment">#define TY_USHORT         ( 8&lt;&lt;4)  80                             </span>
00081 <span class="comment">#define TY_COMPLEX_DOUBLE ( 9&lt;&lt;4)  90                              </span>
00082 <span class="comment">#define TY_COMPLEX_FLOAT  (10&lt;&lt;4)  a0                             </span>
00083 <span class="comment">#define TY_COMPLEX_CHAR   (11&lt;&lt;4)  b0                             </span>
00084 <span class="comment">#define TY_COMPLEX_UCHAR  (12&lt;&lt;4)  c0                            </span>
00085 <span class="comment">#define TY_COMPLEX_SHORT  (13&lt;&lt;4)  d0                             </span>
00086 <span class="comment">#define TY_COMPLEX_USHORT (14&lt;&lt;4)  e0                            </span>
00087 <span class="comment">#define TY_COMPLEX_LONG   (15&lt;&lt;4)  f0                            </span>
00088 <span class="comment">#define TY_BIT            (16&lt;&lt;4) 100                             </span>
00089 <span class="comment">#define TY_IDPOINT        (17&lt;&lt;4) 110</span>
00090 <span class="comment">#define TY_FACE           (18&lt;&lt;4) 120</span>
00091 <span class="comment">#define TY_POINTER        (19&lt;&lt;4) 130            </span>
00092 <span class="comment">#qdefine TY_ULONG         (20&lt;&lt;4) 140            </span>
00093 <span class="comment">#define TY_COMPLEX_ULONG  (21&lt;&lt;4) 150</span>
00094 <span class="comment"></span>
00095 <span class="comment">#define TY_IDXPOINT_CHAR  (22&lt;&lt;4) 160        </span>
00096 <span class="comment">#define TY_IDXPOINT_UCHAR (23&lt;&lt;4) 170</span>
00097 <span class="comment">#define TY_IDXPOINT_FLOAT (24&lt;&lt;4) 180</span>
00098 <span class="comment">#define TY_IDXPOINT_DOUBLE(25&lt;&lt;4) 190</span>
00099 <span class="comment">#define TY_IDXPOINT_SHORT (26&lt;&lt;4) 1a0</span>
00100 <span class="comment">#define TY_IDXPOINT_USHORT(27&lt;&lt;4) 1b0</span>
00101 <span class="comment">#define TY_IDXPOINT_LONG  (28&lt;&lt;4) 1c0</span>
00102 <span class="comment">#define TY_IDXPOINT_ULONG (29&lt;&lt;4) 1d0        </span>
00103 <span class="comment"></span>
00104 <span class="comment">#define TY_COLOR          (30&lt;&lt;4) 1fo</span>
00105 <span class="comment">*/</span>           
00106 
00107 
00108 <span class="comment">//static int rgb; // mais ca servait a QUOI qu'elle soit statique ???</span>
00109 
00110 <span class="comment">// static int sw;</span>
00111 
00112 <span class="comment">/* JPR, pour eviter de dupliquer le source    */</span>
00113 
<a name="l00114"></a><a class="code" href="dcmread_8c.html#a1">00114</a> <span class="preprocessor">#define CCS(Type)                   \</span>
00115 <span class="preprocessor">if(!fread(&amp;((Type)psi)[0],IdSigDimX(psi)*IdSizeOfType(psi),1,e-&gt;fp)) \</span>
00116 <span class="preprocessor">                           \</span>
00117 <span class="preprocessor">         {                       \</span>
00118 <span class="preprocessor">            IdSigFree(psi);               \</span>
00119 <span class="preprocessor">            printf("DcmRead : echec en lecture Signal\n");\</span>
00120 <span class="preprocessor">       return(0);                \</span>
00121 <span class="preprocessor">    }</span>
00122 <span class="preprocessor"></span>
<a name="l00123"></a><a class="code" href="dcmread_8c.html#a2">00123</a> <span class="preprocessor">#define CCC(Type)                   \</span>
00124 <span class="preprocessor">if(!fread(&amp;((Type)pco)[0],IdCntDimX(pco)*IdSizeOfType(pco),1,e-&gt;fp)) \</span>
00125 <span class="preprocessor">                           \</span>
00126 <span class="preprocessor">         {                       \</span>
00127 <span class="preprocessor">            IdCntFree(pco);               \</span>
00128 <span class="preprocessor">            printf("DcmRead : echec en lecture Contour\n"); \</span>
00129 <span class="preprocessor">       return(0);                \</span>
00130 <span class="preprocessor">    }</span>
00131 <span class="preprocessor"></span>
00132 <span class="comment">/* pour les anciens codage de contour */</span>
<a name="l00133"></a><a class="code" href="dcmread_8c.html#a3">00133</a> <span class="preprocessor">#define CCC2(Type)                     \</span>
00134 <span class="preprocessor">if(!fread(&amp;((Type)pco)[0],IdCntDimX(pco)*IdSizeOfType(pco)&gt;&gt;1,1,fp))\</span>
00135 <span class="preprocessor">                           \</span>
00136 <span class="preprocessor">         {                       \</span>
00137 <span class="preprocessor">            IdCntFree(pco);               \</span>
00138 <span class="preprocessor">            printf("DcmRead :echec en lecture Contour\n");  \</span>
00139 <span class="preprocessor">       return(0);                \</span>
00140 <span class="preprocessor">    }</span>
00141 <span class="preprocessor"></span>
<a name="l00142"></a><a class="code" href="dcmread_8c.html#a4">00142</a> <span class="preprocessor">#define CCI(Type,TailleType)                                      \</span>
00143 <span class="preprocessor">   {                                                     \</span>
00144 <span class="preprocessor">   if (vector != NULL) { </span><span class="comment">/* on a une contrainte de rapidite */</span>          \
00145       if(!fread(vector,(int)dim[0]*(int)dim[1]*TailleType,1,e-&gt;fp)){ \
00146             printf("DcmRead :echec en lecture Image dans Vecteur \n");     \
00147                return(0);                                   \
00148       }                                               \
00149    } else {                                              \
00150       for(i=0;i&lt;IdImaDimY(pim);i++){                           \
00151                if(!fread(((Type)pim)[i],IdImaDimX(pim)*IdSizeOfType(pim),1,e-&gt;fp)) { \
00152                      printf("echec en lecture Image [i : %d] lgr de %d \n",  \
00153                   i,IdImaDimX(pim)*IdSizeOfType(pim));         \
00154                      IdImaFree(pim);                                 \
00155                return(0);                                   \
00156          }                                            \
00157       }                                               \
00158    }                                                  \
00159    }                                                     \
00160                                        
<a name="l00161"></a><a class="code" href="dcmread_8c.html#a5">00161</a> <span class="preprocessor">#define CCV(Type)                            \</span>
00162 <span class="preprocessor">   for(j=0;j&lt;IdVolDimZ(pvo);j++){               \</span>
00163 <span class="preprocessor">   </span><span class="comment">/*if (DEBUG) printf("DcmRead CCV: Lecture Plan %d\n", j); */</span>   \
00164      for(i=0;i&lt;IdVolDimY(pvo);i++)              \
00165       if(!fread(((Type)pvo)[j][i],IdVolDimX(pvo)*IdSizeOfType(pvo),1,e-&gt;fp)) \
00166         {                                 \
00167               printf("DcmRead CCV : echec en lecture Volume\n");      \
00168          IdVolFree(pvo);                     \
00169               if (DEBUG) printf("DcmRead CCV : Fin  Liberation Volume\n");\
00170          return(0);                       \
00171          }                                \
00172         }                                 \
00173     if (DEBUG) printf("DcmRead CCV : Fin Lecture Volume\n");
00174 
<a name="l00175"></a><a class="code" href="dcmread_8c.html#a6">00175</a> <span class="preprocessor">#define CCQ(Type)                            \</span>
00176 <span class="preprocessor">   for(k=0;k&lt;IdSeqDimT(pse);k++)             \</span>
00177 <span class="preprocessor">   for(j=0;j&lt;IdSeqDimZ(pse);j++)             \</span>
00178 <span class="preprocessor">     for(i=0;i&lt;IdSeqDimY(pse);i++)              \</span>
00179 <span class="preprocessor">      if(!fread(((Type)pse)[k][j][i],IdSeqDimX(pse)*IdSizeOfType(pse),1,e-&gt;fp))  \</span>
00180 <span class="preprocessor">        {                                 \</span>
00181 <span class="preprocessor">              printf("DcmRead :echec en lecture Sequence\n");  \</span>
00182 <span class="preprocessor">               IdSeqFree(pse);                     \</span>
00183 <span class="preprocessor">              if (DEBUG) printf("DcmRead :Fin  Liberation Sequence\n");\</span>
00184 <span class="preprocessor">         return(0);                       \</span>
00185 <span class="preprocessor">        }</span>
00186 <span class="preprocessor"></span>
00187 
00188 <span class="comment">//-------------------------------------------------------------------------</span>
00189 
00190 <span class="comment">//</span>
00191 <span class="comment">// IdDcmReadFileIntoVector ( est un sur-ensemble de IdDcmReadFile )</span>
00192 <span class="comment">//</span>
00193 
<a name="l00231"></a><a class="code" href="iddcm_8h.html#a14">00231</a> <span class="keywordtype">void</span> *<a class="code" href="iddcm_8h.html#a14">IdDcmReadFileIntoVector</a>(<span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> premIm, <span class="keywordtype">int</span> dernIm, <span class="keywordtype">void</span> * vector) {
00232 
00233 <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> *e;
00234 <span class="keywordtype">void</span> * o;
00235 
00236     <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"----------------------------entree ds  IdDcmReadFileIntoVector\n"</span>);
00237 
00238    <span class="comment">// -------------------------------------------------------------</span>
00239    <span class="comment">// On recupere les info </span>
00240    <span class="comment">// -------------------------------------------------------------</span>
00241    
00242    <span class="keywordflow">if</span>((e=<a class="code" href="iddcm_8h.html#a5">IdDcmGetHeader</a>(filename))==0) {           <span class="comment">// POUR LIRE IMAGES LEONARDO, DECOMMENTER</span>
00243 
00244    <span class="comment">//if((e=IdDcmGetHeaderLeonardo(filename))==0) {</span>
00245       printf (<span class="stringliteral">"Gros soucis : %s\n"</span>,filename);
00246       <span class="keywordflow">return</span> (NULL);
00247         }
00248    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00249       printf(<span class="stringliteral">"DcmReadFileIntoVector : Sortie IdDcmGetHeader\n"</span>);
00250 
00251    o = <a class="code" href="iddcm_8h.html#a15">IdDcmReadFileIntoVectorFromDcmHdr</a>(e,type, premIm, dernIm, vector);
00252    <a class="code" href="iddcm_8h.html#a4">IdDcmHdrFree</a>(e);
00253    <span class="keywordflow">return</span> (o);
00254 }
00255 
00256  
00257 <span class="comment">//-------------------------------------------------------------------------</span>
00258 <span class="comment">//</span>
00259 <span class="comment">// IdDcmReadFileIntoVectorFromDcmHdr ( est un sur-ensemble de IdDcmReadFile )</span>
00260 <span class="comment">//</span>
00261 
<a name="l00299"></a><a class="code" href="iddcm_8h.html#a15">00299</a> <span class="keywordtype">void</span> *<a class="code" href="iddcm_8h.html#a15">IdDcmReadFileIntoVectorFromDcmHdr</a>(<a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> *e, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> premIm, <span class="keywordtype">int</span> dernIm, <span class="keywordtype">void</span> * vector) {
00300    
00301    <a class="code" href="idsig-ido_8h.html#a25">PSIGNAL</a>      psi;
00302    <a class="code" href="idcnt-ido_8h.html#a25">PCONTOUR</a>     pco;
00303    <a class="code" href="idima-ido_8h.html#a23">PPIMAGE</a>      pim;
00304    <a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a>    pvo;
00305    <a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a> pse;
00306    <span class="keywordtype">int</span> i,j,k ;
00307    <span class="keywordtype">int</span> nbIm,imNum,nbTotIm = 0,nbFrames;
00308    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> ndim,nb,ty,nbu, highBit, SamplesPerPixel;
00309    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> dim[4],usedDim[4];
00310    <span class="keywordtype">long</span> <span class="keywordtype">int</span> np,lgrASauter;
00311    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>  typ, typObj = 0;
00312    <span class="keywordtype">char</span> *bufbid;
00313    <span class="keywordtype">void</span> ** tabIm = NULL;
00314    <span class="keywordtype">short</span> <span class="keywordtype">int</span> typePasse;
00315    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> mask5 = 0xffff;
00316    
00317 <span class="comment">// -------------------</span>
00318    <span class="keywordtype">int</span> JpegLossless;
00319    uint32_t ln;
00320 <span class="comment">// ClbJpeg *jpg= NULL;</span>
00321 <span class="comment">// --------------------</span>
00322    
00323    psi=0;
00324    pco=0;
00325    pvo=0;
00326    pim=0;
00327    pse=0;
00328    typePasse=type;
00329     <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"----------------------------entree ds  IdDcmReadFileIntoVectorFromDcmHdr\n"</span>);
00330 
00331    
00332    <span class="keywordflow">if</span> (dernIm &lt; premIm) {
00333       printf(<span class="stringliteral">"num Derniere Image %d &lt; num Premiere Image %d\n"</span>,
00334                premIm,dernIm);
00335       <span class="keywordflow">return</span>(0);
00336    }
00337 
00338    <span class="keywordflow">if</span> (premIm==-1) 
00339       premIm=0;
00340 
00341    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00342       printf(<span class="stringliteral">"pre %d der %d\n"</span>, premIm,dernIm);
00343 
00344    typ = -1;
00345 
00346    e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a> = <a class="code" href="iddcm_8h.html#a6">IdDcmIsAcrLibido</a>(e);
00347 
00348    bufbid=<a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(0x0028,0x0004,e);
00349 
00350    <span class="keywordflow">if</span>(bufbid!=NULL) {         <span class="comment">// RGB</span>
00351       <span class="keywordflow">if</span> (  (memcmp(bufbid,<span class="stringliteral">"RGB "</span>,4)==0)    
00352             ||
00353                   (memcmp(bufbid,<span class="stringliteral">"B RG"</span>,4)==0) 
00354             ||
00355                   (memcmp(bufbid,<span class="stringliteral">" BGR"</span>,4)==0)          
00356             ||
00357                   (memcmp(bufbid,<span class="stringliteral">"GR B"</span>,4)==0)) {
00358 
00359                   <span class="comment">// rgb=1; // Mais elle servait a QUOI tout court ??</span>
00360 
00361          printf (<span class="stringliteral">"Image RGB  -&gt;%s&lt;-\n"</span>, bufbid);
00362       }
00363    }
00364 
00365    <span class="keywordflow">if</span>((ndim=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0005,e))==0xFFFF) {
00366       ndim=2;  <span class="comment">// nb de dim de l'objet (IMA par defaut)</span>
00367    }
00368 
00369    <span class="keywordflow">if</span> ((ndim&gt;4)||(ndim&lt;1)) {
00370       printf (<span class="stringliteral">"nb de dim = %d, errone\n"</span>,ndim);
00371       <span class="keywordflow">return</span>(0);
00372    } <span class="keywordflow">else</span> {
00373       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
00374          printf (<span class="stringliteral">"\t\t\t ndim (0x0028,0x0005) : %d\n"</span>,ndim);
00375       }
00376    }
00377       
00378    <span class="comment">// 10 : nb lignes   allouees</span>
00379    <span class="comment">// 11 : nb colonnes allouees</span>
00380    <span class="comment">// 12 : nb plans    alloues   (     DICOM, non ACR-NEMA )</span>
00381    <span class="comment">// 13 : nb blocs    alloues   ( non DICOM, non ACR-NEMA )</span>
00382    <span class="comment">// 15 : nb lignes   Utilisees ( non DICOM, non ACR-NEMA ) </span>
00383    <span class="comment">// 16 : nb colonnes Utilisees ( non DICOM, non ACR-NEMA )</span>
00384    <span class="comment">// 17 : nb plans    Utilises  ( non DICOM, non ACR-NEMA )</span>
00385    <span class="comment">// 18 : nb blocs    Utilises  ( non DICOM, non ACR-NEMA )</span>
00386                
00387    <span class="comment">// Lecture nbFrames </span>
00388       
00389    <span class="keywordflow">if</span>(!(bufbid=<a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(0x0028,0x0008,e))) {
00390       nbFrames=1; <span class="comment">// mono-frame par defaut</span>
00391    } <span class="keywordflow">else</span> {
00392       nbFrames=atoi(bufbid);
00393       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00394          printf (<span class="stringliteral">"\t\t\t nbFrames (0x0028,0x0008) : %d\n"</span>,nbFrames);
00395    }
00396 
00397    <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++) {
00398          <span class="keywordflow">if</span>((dim[i]=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0010+i,e))==0xFFFF) { 
00399             <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00400             printf (<span class="stringliteral">"IdDcmReadFile : fichier non ACR (0x0028,0x00%d) "</span>
00401                <span class="stringliteral">"missing\n"</span>,10+i);
00402             <span class="keywordflow">return</span> (0);
00403          }  <span class="keywordflow">else</span> {
00404             <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) 
00405                printf (<span class="stringliteral">"\t\t\t ndim (0x0028,0x0005) : dim[%d]=%d\n"</span>,i,dim[i]);
00406          }
00407       }
00408 
00409    <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a>!=1) {
00410       <span class="comment">// si c'est une VRAIE image ACR</span>
00411       <span class="comment">// on permutte NX et NY ds l'entete LibIDO</span>
00412       <span class="keywordtype">int</span> secuDim;
00413       <span class="comment">//printf("on permutte NX et NY ds l'entete LibIDO %d \n",e-&gt;ACR_LIBIDO);</span>
00414 
00415       secuDim = dim[0];
00416       dim[0]  = dim[1];
00417       dim[1]  = secuDim;
00418    } <span class="keywordflow">else</span> {
00419       <span class="comment">//printf("on ne permutte PAS NX et NY ds l'entete LibIDO\n");</span>
00420 
00421       <span class="comment">// Lecture UsedNbX, ... (Uniquement pour ACR LibIDO ...)</span>
00422       
00423       <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
00424          <span class="keywordflow">if</span>((usedDim[i]=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0015+i,e))==0xFFFF)
00425             usedDim[i]=dim[i];
00426       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00427          <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
00428             printf (<span class="stringliteral">"\t\t\t dim[%d]=%d\n"</span>,i,usedDim[i]); 
00429    }
00430 
00431    <span class="keywordflow">if</span>((nb=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0100,e))==0xFFFF) {  <span class="comment">// nb bits allocated</span>
00432       nb=16 ; 
00433       } <span class="keywordflow">else</span> {
00434       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
00435          printf (<span class="stringliteral">"\t\t\t nb (0x0028,0x0100) : %d\n"</span>,nb);
00436       }
00437    }
00438 
00439    <span class="keywordflow">if</span>((nbu=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0101,e))==0xFFFF) { <span class="comment">// nb bits utiles</span>
00440       nbu = nb ; 
00441    } <span class="keywordflow">else</span> {
00442       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
00443          printf (<span class="stringliteral">"\t\t\t nbu (0x0028,0x0101) : %d\n"</span>,nbu);
00444       }
00445         }
00446 
00447    <span class="keywordflow">if</span>((highBit=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0102,e))==0xFFFF) {
00448       <span class="comment">// hight bit pas pris en compte</span>
00449       highBit = nb-1 ;
00450    } <span class="keywordflow">else</span> {
00451       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
00452          printf (<span class="stringliteral">"\t\t\t highBit (0x0028,0x0102) : %d\n"</span>,highBit);
00453       }
00454         }
00455       
00456    mask5 = mask5 &gt;&gt; (nb-nbu);
00457    <span class="keywordflow">if</span>((ty=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0103,e))==0xFFFF) { <span class="comment">// signe o/n</span>
00458       <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00459       printf (<span class="stringliteral">"fichier non ACR (0x0028,0x0103) missing\n"</span>);
00460       <span class="keywordflow">return</span> (0);
00461    } <span class="keywordflow">else</span> {
00462       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
00463          printf (<span class="stringliteral">"\t\t\t signe (0x0028,0x0103) : %d\n"</span>,ty);
00464            }
00465    }
00466 
00467    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
00468       printf(<span class="stringliteral">"nbit alloues=%d nbit Utiles=%d highbit %d signe=%d\n"</span>,
00469           nb,nbu,highBit,ty);
00470       <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
00471          printf(<span class="stringliteral">" dim[%d]= %d; "</span>, i, dim[i]);
00472       printf (<span class="stringliteral">"\n"</span>);
00473    }
00474 
00475    <span class="keywordflow">if</span> (nb==12) {
00476       printf(<span class="stringliteral">"No luck for you ... nbit=12!...  Try  : "</span>
00477              <span class="stringliteral">" AFFIM BYPASSACR=1 NBIT=12 DIMX=%d DIMY=%d OFFSET= ...\n"</span>,
00478             dim[0],dim[1]);
00479       nb=8;
00480       <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
00481       <span class="keywordflow">return</span> (0);
00482    }
00483 
00484    <span class="keywordflow">if</span>(ndim==1) typObj=<a class="code" href="idgen_8h.html#a11">SIG</a>;
00485    <span class="comment">// pas de Pb pour les CNT: _IdAcrCheckType trouvera FORCEMENT</span>
00486    <span class="comment">// l'element (28,199) !</span>
00487    <span class="keywordflow">if</span>(ndim==2) typObj=<a class="code" href="idgen_8h.html#a7">IMA</a>;
00488    <span class="keywordflow">if</span>(ndim==3) typObj=<a class="code" href="idgen_8h.html#a10">VOL</a>;
00489    <span class="keywordflow">if</span>(ndim==4) typObj=<a class="code" href="idgen_8h.html#a9">SEQ</a>;
00490    
00491    <span class="comment">// Lecture SamplesPerPixel (1 : Gray Scale, 3 : RGB)</span>
00492    <span class="keywordflow">if</span>((SamplesPerPixel=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0002,e))==0xFFFF) {
00493       SamplesPerPixel=1;   <span class="comment">// (Gray Scale par defaut)</span>
00494    }
00495 
00496    <span class="comment">// on essaye, a titre d'info, de verifier le type, ds le fichier</span>
00497    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)printf (<span class="stringliteral">"appel = IdAcrCheckType\n"</span>);
00498    
00499    typ=<a class="code" href="iddcm-restricted_8h.html#a5">_IdDcmCheckType</a>(e,ty,nb,typObj, SamplesPerPixel);
00500       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)printf (<span class="stringliteral">"Sortie = IdAcrCheckType\n"</span>);
00501 
00502    <span class="keywordflow">if</span>(ndim==1) typObj = typ &amp; <a class="code" href="idgen_8h.html#a6">IDO_TYPE</a>; <span class="comment">// Les CNT ont AUSSI ndim=1 !...</span>
00503 
00504    <span class="keywordflow">if</span> (typ!=typePasse)
00505       printf (<span class="stringliteral">"typeTrouve= %x typePasse= %x\n"</span>, typ, typePasse);
00506 
00507    typ=typePasse;  <span class="comment">// Si ca ne cadre pas, on considere que la valeur</span>
00508             <span class="comment">// passee est la bonne</span>
00509          
00510    np= e-&gt;<a class="code" href="structID__DCM__HDR.html#o14">PixelPosition</a>;
00511 
00512    <span class="keywordflow">if</span>((e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>=fopen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>,<a class="code" href="idio_8h.html#a0">ID_RFILE_BIN</a>))==0) {
00513       printf (<span class="stringliteral">"echec ouverture  %s\n"</span>,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>);
00514       <span class="keywordflow">return</span> (0);
00515         }
00516    fseek(e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>,np,<a class="code" href="simri3d_8h.html#a15">SEEK_CUR</a>);  <span class="comment">// On se positionne sur le début présumé des Pixels </span>
00517    
00518    typObj=type&amp;0x000f;     <span class="comment">// Recomputed from result of _IdAcrCheckType</span>
00519    type  =type&amp;0xfff0;
00520 
00521 
00522    <span class="keywordflow">if</span> ( premIm != -2) {    <span class="comment">// on n'est pas ds MultiFrame</span>
00523       lgrASauter = <a class="code" href="idgen_8h.html#a87">IdTypeSize</a>(type);
00524 
00525       <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
00526          lgrASauter = lgrASauter * dim[i];   <span class="comment">// taille d'un Frame</span>
00527 
00528       lgrASauter = lgrASauter * premIm;      <span class="comment">// si on veut ignorer les Frames de debut</span>
00529       nbTotIm=nbFrames;
00530    }
00531 
00532    <span class="keywordflow">if</span> (dernIm==-1)
00533       dernIm=nbTotIm-1;
00534 
00535    nbIm = dernIm - premIm +1;
00536       
00537    <span class="keywordflow">if</span> ( (JpegLossless=<a class="code" href="iddcm_8h.html#a7">IdDcmIsJpegLossless</a>(e)) ) {     <span class="comment">// si Jpeg Lossless, on ne tente pas d'aventure</span>
00538    <span class="comment">/*</span>
00539 <span class="comment">      premIm = 1;</span>
00540 <span class="comment">      dernIm=nbTotIm-1;</span>
00541 <span class="comment">      nbIm = dernIm - premIm +1;</span>
00542 <span class="comment">      lgrASauter = 0;</span>
00543 <span class="comment">   */</span>
00544    }
00545       
00546       
00547 
00548    <span class="comment">//-------------------------------------------------------------</span>
00549    <span class="comment">// Fin recup. info pour pouvoir Allouer</span>
00550    <span class="comment">//-------------------------------------------------------------</span>
00551 
00552    <span class="keywordflow">if</span> (vector == NULL) {
00553       tabIm = (<span class="keywordtype">void</span> **) calloc((nbIm+1),<span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
00554       <span class="keywordflow">if</span>(!tabIm) {
00555          printf(<span class="stringliteral">"Echec Alloc Table d Images : premIm %d dernIm %d nbIm %d\n"</span>,
00556                 premIm, dernIm,nbIm);
00557          <span class="keywordflow">return</span> NULL;
00558       }
00559    }
00560    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"OK Alloc Table d Images\n"</span>);
00561  
00562    <span class="comment">//-------------------------------------------------------------</span>
00563    <span class="comment">// Pour CHAQUE 'Objet' du Fichier</span>
00564    <span class="comment">//-------------------------------------------------------------</span>
00565    <span class="keywordflow">for</span>(imNum=premIm;imNum&lt;dernIm+1;imNum++) {
00566       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00567          printf(<span class="stringliteral">"imNum %d, typObj %x\n"</span>,imNum,typObj);
00568          <span class="keywordflow">switch</span>(typObj) {
00569 
00570       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a11">SIG</a>:
00571       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00572          printf(<span class="stringliteral">"SIGNAL\n"</span>);
00573 
00574          <span class="keywordflow">if</span>(0==(((<a class="code" href="idsig-ido_8h.html#a25">PSIGNAL</a> *)tabIm)[imNum-premIm]=psi
00575             =<a class="code" href="sigallo_8c.html#a1">IdSigAlloc</a>((<span class="keywordtype">int</span>)dim[0],typ))) {
00576             printf(<span class="stringliteral">"echec alloc Signal\n"</span>);
00577             <span class="keywordflow">return</span>(0);
00578          }
00579          <span class="keywordflow">switch</span>(type) { <span class="comment">// 4 derniers bits : SIG, IMA, VOL, SEQ</span>
00580          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>:
00581             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a27">PSIGNAL_UCHAR</a>);
00582             <span class="keywordflow">break</span>;
00583          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>:
00584             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a26">PSIGNAL_CHAR</a>);
00585             <span class="keywordflow">break</span>;
00586          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>:
00587             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a33">PSIGNAL_USHORT</a>);
00588             <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,21,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a27">TY_USHORT</a>);
00589             <span class="keywordflow">break</span>;
00590          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>:
00591             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a32">PSIGNAL_SHORT</a>);
00592             <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,21,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a24">TY_SHORT</a>);
00593             <span class="keywordflow">break</span>;
00594          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a25">TY_LONG</a>:
00595             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a34">PSIGNAL_LONG</a>);
00596                      <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a25">TY_LONG</a>);
00597                <span class="keywordflow">break</span>;
00598          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>:
00599             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a35">PSIGNAL_ULONG</a>);
00600                      <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a39">TY_ULONG</a>);
00601                <span class="keywordflow">break</span>;
00602          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>:
00603             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a28">PSIGNAL_FLOAT</a>);
00604             <span class="keywordflow">break</span>;
00605          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>:
00606             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="idsig-ido_8h.html#a29">PSIGNAL_DOUBLE</a>);
00607             <span class="keywordflow">break</span>;
00608          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a23">TY_RGB</a>:
00609             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structRGB.html">PSIGNAL_RGB</a>);
00610             <span class="keywordflow">break</span>;
00611                
00612          <span class="comment">// revoir le pb du Swap des complexes....</span>
00613          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a31">TY_COMPLEX_UCHAR</a>:
00614             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__UCHAR.html">PSIGNAL_COMPLEX_UCHAR</a>);
00615             <span class="keywordflow">break</span>;
00616          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a30">TY_COMPLEX_CHAR</a>:
00617             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__CHAR.html">PSIGNAL_COMPLEX_CHAR</a>);
00618             <span class="keywordflow">break</span>;
00619          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>:
00620             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__USHORT.html">PSIGNAL_COMPLEX_USHORT</a>);
00621             <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,21,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>);
00622             <span class="keywordflow">break</span>;
00623          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>:
00624             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__SHORT.html">PSIGNAL_COMPLEX_SHORT</a>);
00625             <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,21,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>);
00626             <span class="keywordflow">break</span>;
00627          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>:
00628             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__LONG.html">PSIGNAL_COMPLEX_LONG</a>);
00629             <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>);
00630                <span class="keywordflow">break</span>;
00631          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>:
00632             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__ULONG.html">PSIGNAL_COMPLEX_ULONG</a>);
00633                      <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) _Swap(psi,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,(<span class="keywordtype">int</span>)dim[0],<a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>);
00634                <span class="keywordflow">break</span>;
00635          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a22">TY_COMPLEX</a>:
00636             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX.html">PSIGNAL_COMPLEX</a>);
00637             <span class="keywordflow">break</span>;   
00638          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a29">TY_COMPLEX_FLOAT</a>:
00639             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__FLOAT.html">PSIGNAL_COMPLEX_FLOAT</a>);
00640             <span class="keywordflow">break</span>;   
00641          <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a28">TY_COMPLEX_DOUBLE</a>:
00642             <a class="code" href="acrread_8c.html#a0">CCS</a>(<a class="code" href="structCOMPLEX__DOUBLE.html">PSIGNAL_COMPLEX_DOUBLE</a>);
00643             <span class="keywordflow">break</span>;   
00644          } <span class="comment">// end switch(type)</span>
00645       
00646          <a class="code" href="idsig-ido_8h.html#a19">_IdSigPrivate</a>(psi)-&gt;_fichier=
00647             (<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>)+1);
00648          <span class="keywordflow">if</span>(premIm == -2)
00649             strcpy(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(psi)-&gt;_fichier,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>);
00650          <span class="keywordflow">else</span>
00651             sprintf(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(psi)-&gt;_fichier,<span class="stringliteral">"%s[%d]"</span>,
00652                e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>,imNum);
00653 
00654          <a class="code" href="idsig-ido_8h.html#a19">_IdSigPrivate</a>(psi)-&gt;_message=
00655             (<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>)+1);
00656          strcpy(<a class="code" href="idsig-ido_8h.html#a19">_IdSigPrivate</a>(psi)-&gt;_message,e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>);
00657          <a class="code" href="idsig-ido_8h.html#a22">IdSigSetUsedNbX</a>(psi,usedDim[0]);
00658          <span class="keywordflow">break</span>;
00659 
00660       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a16">CNT</a>:
00661       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00662          printf(<span class="stringliteral">"CONTOUR\n"</span>);
00663 
00664    <span class="keywordflow">if</span>(0==(((<a class="code" href="idcnt-ido_8h.html#a25">PCONTOUR</a> *)tabIm)[imNum-premIm]=pco=<a class="code" href="idcnt-base_8h.html#a4">IdCntAlloc</a>((<span class="keywordtype">int</span>)dim[0],typ)))
00665 
00666             { printf(<span class="stringliteral">"echec alloc Contour\n"</span>);
00667          <span class="keywordflow">return</span>(0);
00668         }
00669 
00670       <span class="keywordflow">switch</span>(type)   <span class="comment">/* 4 derniers bits : SIG, CNT, IMA, VOL, SEQ */</span>
00671       {
00672 
00673       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>:  <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__UCHAR.html">PCONTOUR_UCHAR</a>);   <span class="keywordflow">break</span>;
00674       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>:   <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__CHAR.html">PCONTOUR_CHAR</a>);    <span class="keywordflow">break</span>;
00675       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>: <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__USHORT.html">PCONTOUR_USHORT</a>);
00676          <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pco,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0],<a class="code" href="idgen_8h.html#a27">TY_USHORT</a>);     <span class="comment">/* VOIR le Pb du SWAP */</span>
00677                      <span class="keywordflow">break</span>;
00678       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>:  <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__SHORT.html">PCONTOUR_SHORT</a>);
00679                          <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pco,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0],<a class="code" href="idgen_8h.html#a24">TY_SHORT</a>);
00680                      <span class="keywordflow">break</span>;
00681       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a25">TY_LONG</a>:   <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__LONG.html">PCONTOUR_LONG</a>);
00682                      <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pco,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0],<a class="code" href="idgen_8h.html#a25">TY_LONG</a>);
00683                         <span class="keywordflow">break</span>;
00684       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>:   <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__ULONG.html">PCONTOUR_ULONG</a>);
00685                      <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pco,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0],<a class="code" href="idgen_8h.html#a39">TY_ULONG</a>);
00686                         <span class="keywordflow">break</span>;
00687  
00688       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>:  <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__FLOAT.html">PCONTOUR_FLOAT</a>);   <span class="keywordflow">break</span>;
00689       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>: <a class="code" href="acrread_8c.html#a1">CCC</a>(<a class="code" href="structIDXPOINT__DOUBLE.html">PCONTOUR_DOUBLE</a>);  <span class="keywordflow">break</span>;
00690 
00691               }   
00692       
00693       <a class="code" href="idcnt-ido_8h.html#a8">_IdCntPrivate</a>(pco)-&gt;_fichier=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>)+1);
00694            <span class="keywordflow">if</span>(premIm == -2)   strcpy(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pco)-&gt;_fichier,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>);
00695       <span class="keywordflow">else</span>        sprintf(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pco)-&gt;_fichier,<span class="stringliteral">"%s[%d]"</span>,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>,imNum);
00696 
00697       <a class="code" href="idcnt-ido_8h.html#a8">_IdCntPrivate</a>(pco)-&gt;_message=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>)+1);
00698       strcpy(<a class="code" href="idcnt-ido_8h.html#a8">_IdCntPrivate</a>(pco)-&gt;_message,e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>);
00699 
00700       <a class="code" href="idcnt-ido_8h.html#a21">IdCntSetUsedNbX</a>(pco,usedDim[0]);
00701       <span class="keywordflow">break</span>;
00702 
00703       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a7">IMA</a>:
00704    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00705       printf(<span class="stringliteral">"IMAGE %d %d\n"</span>,(<span class="keywordtype">int</span>)dim[0],(<span class="keywordtype">int</span>)dim[1]);
00706 
00707    <span class="keywordflow">if</span>(vector==NULL) {
00708       <span class="keywordflow">if</span>(0==(((<a class="code" href="idima-ido_8h.html#a23">PPIMAGE</a> *)tabIm)[imNum-premIm]=
00709             pim=<a class="code" href="imaallo_8c.html#a9">IdImaAlloc</a>((<span class="keywordtype">int</span>)dim[0],(<span class="keywordtype">int</span>)dim[1],typ))) { 
00710          printf(<span class="stringliteral">"echec alloc Image \n"</span>);
00711                <span class="keywordflow">return</span>(0);
00712       }
00713       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00714             printf(<span class="stringliteral">"Succes alloc Image nX %d nY %d \n"</span>,<a class="code" href="imabasic_8c.html#a5">IdImaDimX</a>(pim),<a class="code" href="imabasic_8c.html#a4">IdImaDimY</a>(pim));
00715    }
00716 
00717    <span class="keywordflow">switch</span>(type)
00718          {
00719       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>:  <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a25">PPIMAGE_UCHAR</a>, <a class="code" href="idgen_8h.html#a52">TA_TY_UCHAR</a>);      
00720                   <span class="keywordflow">break</span>;
00721 
00722       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>:   <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a24">PPIMAGE_CHAR</a>, <a class="code" href="idgen_8h.html#a51">TA_TY_CHAR</a>);
00723                   <span class="keywordflow">break</span>;
00724    
00725       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>: 
00726       
00727          <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o9">__TrueDicom</a> &amp;&amp; !<a class="code" href="iddcm_8h.html#a8">IdDcmIsUncompressed</a>(e)) {
00728             
00729                <span class="comment">// skip to the beggining of the pixels</span>
00730                
00731                fseek(e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>,4,<a class="code" href="simri3d_8h.html#a15">SEEK_CUR</a>);
00732                fread(&amp;ln,4,1,e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>); 
00733                <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) 
00734                ln=<a class="code" href="iddcm-restricted_8h.html#a7">_IdDcmSWAP_LONG</a>(ln,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>);
00735             <span class="comment">//if (DEBUG) </span>
00736                printf (<span class="stringliteral">"ln %d\n"</span>,ln);
00737                fseek(e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>,ln,<a class="code" href="simri3d_8h.html#a15">SEEK_CUR</a>);
00738                fseek(e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>,4,<a class="code" href="simri3d_8h.html#a15">SEEK_CUR</a>);
00739                fread(&amp;ln,4,1,e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>); 
00740                <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) 
00741              ln=<a class="code" href="iddcm-restricted_8h.html#a7">_IdDcmSWAP_LONG</a>(ln,e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>);
00742             <span class="comment">//if (DEBUG) </span>
00743                printf (<span class="stringliteral">"ln image comprimée %d\n"</span>,ln);
00744                
00745                
00746                printf(<span class="stringliteral">"Sorry, Bits Stored = %d not yet taken into account\n"</span>,nbu);
00747                <span class="keywordflow">return</span> NULL;
00748                
00749          } <span class="keywordflow">else</span> { <span class="comment">// Old ACR-NEMA or uncompressed</span>
00750       
00751             <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a32">PPIMAGE_USHORT</a>, <a class="code" href="idgen_8h.html#a59">TA_TY_USHORT</a>);
00752                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>) {
00753                                  <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"_Swap\n"</span>);
00754 
00755                _Swap(pim[0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,(<span class="keywordtype">int</span>)dim[0]*(<span class="keywordtype">int</span>)dim[1],<a class="code" href="idgen_8h.html#a27">TY_USHORT</a>);
00756                  <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"\t\t\tOn swappe\n"</span>);
00757             } <span class="comment">// end if(e-&gt;sw)</span>
00758                         <span class="keywordflow">if</span> (nbu!=nb)  <span class="comment">/* GB */</span>
00759                <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="imabasic_8c.html#a4">IdImaDimY</a>(pim);i++)
00760                <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="imabasic_8c.html#a5">IdImaDimX</a>(pim);j++)
00761                   ((<a class="code" href="idima-ido_8h.html#a32">PPIMAGE_USHORT</a>)pim)[i][j] = 
00762                      (((<a class="code" href="idima-ido_8h.html#a32">PPIMAGE_USHORT</a>)pim)[i][j] &gt;&gt; (nbu-highBit-1)) &amp; mask5;
00763          } <span class="comment">// end else Old ACR-NEMA</span>
00764          
00765             
00766          <span class="keywordflow">break</span>;
00767 
00768       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>:  <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a31">PPIMAGE_SHORT</a>,<a class="code" href="idgen_8h.html#a58">TA_TY_SHORT</a>); <span class="comment">// les 16 bits </span>
00769                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],21,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a24">TY_SHORT</a>);
00770                   <span class="keywordflow">break</span>;
00771 
00772       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>:   <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a34">PPIMAGE_ULONG</a>,<a class="code" href="idgen_8h.html#a61">TA_TY_ULONG</a>);
00773                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a39">TY_ULONG</a>);
00774                   <span class="keywordflow">break</span>;
00775 
00776       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a25">TY_LONG</a>:   <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a33">PPIMAGE_LONG</a>,<a class="code" href="idgen_8h.html#a60">TA_TY_LONG</a>);
00777                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a25">TY_LONG</a>);
00778                   <span class="keywordflow">break</span>;
00779          
00780       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>:  <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a26">PPIMAGE_FLOAT</a>,<a class="code" href="idgen_8h.html#a53">TA_TY_FLOAT</a>);    
00781                   <span class="keywordflow">break</span>;
00782 
00783       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>: <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="idima-ido_8h.html#a27">PPIMAGE_DOUBLE</a>,<a class="code" href="idgen_8h.html#a54">TA_TY_DOUBLE</a>);  
00784                   <span class="keywordflow">break</span>;
00785 
00786       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a23">TY_RGB</a>:    <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structRGB.html">PPIMAGE_RGB</a>,<a class="code" href="idgen_8h.html#a56">TA_TY_RGB</a>);                          
00787                   <span class="keywordflow">break</span>;
00788       
00789       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a31">TY_COMPLEX_UCHAR</a>:  <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__UCHAR.html">PPIMAGE_COMPLEX_UCHAR</a>,<a class="code" href="idgen_8h.html#a65">TA_TY_COMPLEX_UCHAR</a>);    
00790                   <span class="keywordflow">break</span>;
00791 
00792       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a30">TY_COMPLEX_CHAR</a>:   <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__CHAR.html">PPIMAGE_COMPLEX_CHAR</a>,<a class="code" href="idgen_8h.html#a64">TA_TY_COMPLEX_CHAR</a>);      
00793                   <span class="keywordflow">break</span>;
00794    
00795       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>: <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__USHORT.html">PPIMAGE_COMPLEX_USHORT</a>, <a class="code" href="idgen_8h.html#a67">TA_TY_COMPLEX_USHORT</a>); 
00796                                 <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],21,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>);
00797                   <span class="keywordflow">break</span>;
00798    
00799       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>:  <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__SHORT.html">PPIMAGE_COMPLEX_SHORT</a>, <a class="code" href="idgen_8h.html#a66">TA_TY_COMPLEX_SHORT</a>); 
00800                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],21,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>);
00801                   <span class="keywordflow">break</span>;
00802 
00803       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>:   <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__ULONG.html">PPIMAGE_COMPLEX_ULONG</a>, <a class="code" href="idgen_8h.html#a69">TA_TY_COMPLEX_ULONG</a>);
00804                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>);
00805                   <span class="keywordflow">break</span>;
00806 
00807       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>:   <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__LONG.html">PPIMAGE_COMPLEX_LONG</a>, <a class="code" href="idgen_8h.html#a68">TA_TY_COMPLEX_LONG</a>);
00808                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pim[0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1],<a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>);
00809                   <span class="keywordflow">break</span>;
00810 
00811       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a29">TY_COMPLEX_FLOAT</a>:  <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__FLOAT.html">PPIMAGE_COMPLEX_FLOAT</a>, <a class="code" href="idgen_8h.html#a63">TA_TY_COMPLEX_FLOAT</a>);   
00812                   <span class="keywordflow">break</span>;
00813 
00814       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a28">TY_COMPLEX_DOUBLE</a>: <a class="code" href="acrread_8c.html#a3">CCI</a>(<a class="code" href="structCOMPLEX__DOUBLE.html">PPIMAGE_COMPLEX_DOUBLE</a>, <a class="code" href="idgen_8h.html#a62">TA_TY_COMPLEX_DOUBLE</a>);    
00815                   <span class="keywordflow">break</span>;
00816       
00817                }                    <span class="comment">/* end switch Type*/</span>
00818    
00819       <span class="keywordflow">if</span> (vector == NULL) {
00820          <a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pim)-&gt;_fichier=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>)+1);
00821                <span class="keywordflow">if</span>(premIm == -2)  strcpy (<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pim)-&gt;_fichier,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>);
00822             <span class="keywordflow">else</span>        sprintf(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pim)-&gt;_fichier,<span class="stringliteral">"%s[%d]"</span>,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>,imNum);
00823 
00824          <a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pim)-&gt;_message=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>)+1);
00825          strcpy(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pim)-&gt;_message,e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>);
00826 
00827          <a class="code" href="imabasic_8c.html#a9">IdImaSetUsedNbX</a>(pim,usedDim[0]);
00828          <a class="code" href="imabasic_8c.html#a8">IdImaSetUsedNbY</a>(pim,usedDim[1]);
00829       }
00830       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"sortie swich case IMA\n"</span>);
00831 
00832             <span class="keywordflow">break</span>;
00833 
00834       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a10">VOL</a>:
00835       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00836          printf(<span class="stringliteral">"VOLUME\n"</span>);
00837 
00838    <span class="comment">/*if(0==(pvo=IdVolAlloc((int)dim[0],(int)dim[1],(int)dim[2],typ)))*/</span>
00839    
00840    <span class="keywordflow">if</span>(0==(((<a class="code" href="idvol-ido_8h.html#a34">PPPVOLUME</a> *)tabIm)[imNum-premIm] = pvo = 
00841             <a class="code" href="volallo_8c.html#a1">IdVolAlloc</a>((<span class="keywordtype">int</span>)dim[0],(<span class="keywordtype">int</span>)dim[1],(<span class="keywordtype">int</span>)dim[2],typ)))
00842          {  printf (<span class="stringliteral">"echec alloc Volume\n"</span>);
00843       <span class="keywordflow">return</span>(0);
00844           } <span class="keywordflow">else</span> {
00845       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00846          printf(<span class="stringliteral">"Succes Alloc VOLUME %d %d %d \n"</span>,(<span class="keywordtype">int</span>)dim[0],(<span class="keywordtype">int</span>)dim[1],(<span class="keywordtype">int</span>)dim[2]);
00847           }
00848           
00849           <span class="keywordflow">switch</span>(type) {
00850       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>:  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a36">PPPVOLUME_UCHAR</a>);     <span class="keywordflow">break</span>;
00851       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>:   <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a35">PPPVOLUME_CHAR</a>);      <span class="keywordflow">break</span>;   
00852       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>: <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a42">PPPVOLUME_USHORT</a>);
00853                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],21,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a27">TY_USHORT</a>);
00854                      <span class="keywordflow">break</span>;   
00855       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>:  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a41">PPPVOLUME_SHORT</a>); 
00856                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],21,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a24">TY_SHORT</a>);
00857                      <span class="keywordflow">break</span>;
00858       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>:   <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a44">PPPVOLUME_ULONG</a>);
00859                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a39">TY_ULONG</a>);
00860                            <span class="keywordflow">break</span>;
00861       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a25">TY_LONG</a>:   <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a43">PPPVOLUME_LONG</a>);
00862                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a25">TY_LONG</a>);
00863                      <span class="keywordflow">break</span>;
00864       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>:  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a37">PPPVOLUME_FLOAT</a>);     <span class="keywordflow">break</span>;   
00865       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>: <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="idvol-ido_8h.html#a38">PPPVOLUME_DOUBLE</a>);    <span class="keywordflow">break</span>;   
00866 
00867       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a23">TY_RGB</a>:    <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structRGB.html">PPPVOLUME_RGB</a>);       <span class="keywordflow">break</span>;   
00868       
00869       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a31">TY_COMPLEX_UCHAR</a>:  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__UCHAR.html">PPPVOLUME_COMPLEX_UCHAR</a>);    <span class="keywordflow">break</span>;
00870       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a30">TY_COMPLEX_CHAR</a>:   <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__CHAR.html">PPPVOLUME_COMPLEX_CHAR</a>);     <span class="keywordflow">break</span>;   
00871       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>: <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__USHORT.html">PPPVOLUME_COMPLEX_USHORT</a>);
00872                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],21,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>);
00873                      <span class="keywordflow">break</span>;   
00874       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>:  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__SHORT.html">PPPVOLUME_COMPLEX_SHORT</a>); 
00875                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],21,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>);
00876                      <span class="keywordflow">break</span>;   
00877       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>:   <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__ULONG.html">PPPVOLUME_COMPLEX_ULONG</a>);
00878                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>);
00879                            <span class="keywordflow">break</span>;
00880       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>:   <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__LONG.html">PPPVOLUME_COMPLEX_LONG</a>);
00881                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pvo[0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2],<a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>);
00882                      <span class="keywordflow">break</span>;
00883       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a22">TY_COMPLEX</a>        :  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX.html">PPPVOLUME_COMPLEX</a>);     <span class="keywordflow">break</span>;   
00884       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a29">TY_COMPLEX_FLOAT</a>:  <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__FLOAT.html">PPPVOLUME_COMPLEX_FLOAT</a>);    <span class="keywordflow">break</span>;   
00885       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a28">TY_COMPLEX_DOUBLE</a>: <a class="code" href="acrread_8c.html#a4">CCV</a>(<a class="code" href="structCOMPLEX__DOUBLE.html">PPPVOLUME_COMPLEX_DOUBLE</a>);   <span class="keywordflow">break</span>;   
00886       }
00887 
00888       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"fin switch\n"</span>);
00889       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">" lgr champ 'fichier' %d\n"</span>,strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>)+1 );
00890        <a class="code" href="idvol-ido_8h.html#a20">_IdVolPrivate</a>(pvo)-&gt;_fichier=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>)+1);
00891        
00892        <span class="keywordflow">if</span>(!(<a class="code" href="idvol-ido_8h.html#a20">_IdVolPrivate</a>(pvo)-&gt;_fichier ) ) {
00893          printf(<span class="stringliteral">"DcmRead : Echec Alloc champ 'nom fichier'\n"</span>);
00894        }
00895        <span class="keywordflow">if</span>(premIm == -2) strcpy(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pvo)-&gt;_fichier,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>);
00896        <span class="keywordflow">else</span>        sprintf(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pvo)-&gt;_fichier,<span class="stringliteral">"%s[%d]"</span>,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>,imNum);
00897 
00898        <a class="code" href="idvol-ido_8h.html#a20">_IdVolPrivate</a>(pvo)-&gt;_message=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>)+1);
00899        <span class="keywordflow">if</span>(!(<a class="code" href="idvol-ido_8h.html#a20">_IdVolPrivate</a>(pvo)-&gt;_message ) ) {
00900          printf(<span class="stringliteral">"DcmRead : Echec Alloc champ 'message'\n"</span>);
00901        }     
00902        strcpy(<a class="code" href="idvol-ido_8h.html#a20">_IdVolPrivate</a>(pvo)-&gt;_message,e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>);
00903        <a class="code" href="idvol-ido_8h.html#a27">IdVolSetUsedNbX</a>(pvo,usedDim[0]);
00904        <a class="code" href="idvol-ido_8h.html#a29">IdVolSetUsedNbY</a>(pvo,usedDim[1]);
00905        <a class="code" href="idvol-ido_8h.html#a31">IdVolSetUsedNbZ</a>(pvo,usedDim[2]);
00906        
00907        <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"fin lect VOLUME\n"</span>);
00908        
00909             <span class="keywordflow">break</span>;
00910 
00911       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a9">SEQ</a>:
00912       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
00913          printf(<span class="stringliteral">"SEQUENCE\n"</span>);
00914 
00915    <span class="keywordflow">if</span>(0==(((<a class="code" href="idseq-ido_8h.html#a40">PPPPSEQUENCE</a> * )tabIm)[imNum-premIm]=pse=<a class="code" href="seqallo_8c.html#a1">IdSeqAlloc</a>((<span class="keywordtype">int</span>)dim[0],(<span class="keywordtype">int</span>)dim[1],(<span class="keywordtype">int</span>)dim[2],(<span class="keywordtype">int</span>)dim[3],typ)))
00916       <span class="keywordflow">if</span>(0==(pse=<a class="code" href="seqallo_8c.html#a1">IdSeqAlloc</a>((<span class="keywordtype">int</span>)dim[0],(<span class="keywordtype">int</span>)dim[1],(<span class="keywordtype">int</span>)dim[2],(<span class="keywordtype">int</span>)dim[3],typ))) {  
00917          printf (<span class="stringliteral">"echec alloc Sequence\n"</span>);
00918          <span class="keywordflow">return</span>(0);
00919             }
00920       <span class="keywordflow">switch</span>(type)
00921          {
00922       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>:  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a42">PPPPSEQUENCE_UCHAR</a>);     <span class="keywordflow">break</span>;
00923       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>:   <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a41">PPPPSEQUENCE_CHAR</a>);      <span class="keywordflow">break</span>;   
00924       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>: <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a48">PPPPSEQUENCE_USHORT</a>);
00925                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],21,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a27">TY_USHORT</a>);
00926                         <span class="keywordflow">break</span>;   
00927       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>:  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a47">PPPPSEQUENCE_SHORT</a>); 
00928                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],21,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a24">TY_SHORT</a>);
00929                         <span class="keywordflow">break</span>;
00930       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>:   <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a50">PPPPSEQUENCE_ULONG</a>);
00931                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a39">TY_ULONG</a>);
00932                               <span class="keywordflow">break</span>;
00933       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a25">TY_LONG</a>:   <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a49">PPPPSEQUENCE_LONG</a>);
00934                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a25">TY_LONG</a>);
00935                         <span class="keywordflow">break</span>;
00936       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>:  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a43">PPPPSEQUENCE_FLOAT</a>);     <span class="keywordflow">break</span>;   
00937       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>: <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="idseq-ido_8h.html#a44">PPPPSEQUENCE_DOUBLE</a>);    <span class="keywordflow">break</span>;   
00938 
00939       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a23">TY_RGB</a>:    <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structRGB.html">PPPPSEQUENCE_RGB</a>);       <span class="keywordflow">break</span>;   
00940       
00941       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a31">TY_COMPLEX_UCHAR</a>:  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__UCHAR.html">PPPPSEQUENCE_COMPLEX_UCHAR</a>);    <span class="keywordflow">break</span>;
00942       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a30">TY_COMPLEX_CHAR</a>:   <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__CHAR.html">PPPPSEQUENCE_COMPLEX_CHAR</a>);     <span class="keywordflow">break</span>;   
00943       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>: <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__USHORT.html">PPPPSEQUENCE_COMPLEX_USHORT</a>);
00944                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],21,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a33">TY_COMPLEX_USHORT</a>);
00945                               <span class="keywordflow">break</span>;   
00946       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>:  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__SHORT.html">PPPPSEQUENCE_COMPLEX_SHORT</a>); 
00947                                  <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],21,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a32">TY_COMPLEX_SHORT</a>);
00948                               <span class="keywordflow">break</span>;   
00949       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>:   <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__ULONG.html">PPPPSEQUENCE_COMPLEX_ULONG</a>);
00950                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a40">TY_COMPLEX_ULONG</a>);
00951                                     <span class="keywordflow">break</span>;
00952       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>:   <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__LONG.html">PPPPSEQUENCE_COMPLEX_LONG</a>);
00953                   <span class="keywordflow">if</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>)_Swap(pse[0][0][0],e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>,dim[0]*dim[1]*dim[2]*dim[3],<a class="code" href="idgen_8h.html#a34">TY_COMPLEX_LONG</a>);
00954                               <span class="keywordflow">break</span>;
00955       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a22">TY_COMPLEX</a>        :  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX.html">PPPPSEQUENCE_COMPLEX</a>);        <span class="keywordflow">break</span>;   
00956       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a29">TY_COMPLEX_FLOAT</a>:  <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__FLOAT.html">PPPPSEQUENCE_COMPLEX_FLOAT</a>);    <span class="keywordflow">break</span>;   
00957       <span class="keywordflow">case</span> <a class="code" href="idgen_8h.html#a28">TY_COMPLEX_DOUBLE</a>: <a class="code" href="acrread_8c.html#a5">CCQ</a>(<a class="code" href="structCOMPLEX__DOUBLE.html">PPPPSEQUENCE_COMPLEX_DOUBLE</a>);   <span class="keywordflow">break</span>;   
00958 
00959                   }
00960 
00961       <a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(pse)-&gt;_fichier=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>)+1);
00962            <span class="keywordflow">if</span>(premIm == -2)   strcpy(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pse)-&gt;_fichier,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>);
00963       <span class="keywordflow">else</span>        sprintf(<a class="code" href="idima-ido_8h.html#a22">_IdImaPrivate</a>(pse)-&gt;_fichier,<span class="stringliteral">"%s[%d]"</span>,e-&gt;<a class="code" href="structID__DCM__HDR.html#o0">filename</a>,imNum);
00964 
00965       <a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(pse)-&gt;_message=(<span class="keywordtype">char</span> *)malloc(strlen(e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>)+1);
00966       strcpy(<a class="code" href="idseq-ido_8h.html#a20">_IdSeqPrivate</a>(pse)-&gt;_message,e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>);
00967 
00968       <a class="code" href="idseq-ido_8h.html#a29">IdSeqSetUsedNbX</a>(pse,usedDim[0]);
00969       <a class="code" href="idseq-ido_8h.html#a31">IdSeqSetUsedNbY</a>(pse,usedDim[1]);
00970       <a class="code" href="idseq-ido_8h.html#a33">IdSeqSetUsedNbZ</a>(pse,usedDim[2]);
00971       <a class="code" href="idseq-ido_8h.html#a35">IdSeqSetUsedNbT</a>(pse,usedDim[3]);
00972             <span class="keywordflow">break</span>;
00973 
00974     }                         <span class="comment">/* end switch typObj */</span>
00975 
00976  }  <span class="comment">/* end for : On a parcouru tous les 'objets' du fichier */</span>
00977 
00978     fclose(e-&gt;<a class="code" href="structID__DCM__HDR.html#o1">fp</a>);
00979     <span class="keywordflow">return</span> tabIm;
00980 }
00981 
00982 
00983 <span class="comment">/* ----------------------------------------------------------------------- */</span>
<a name="l00994"></a><a class="code" href="iddcm_8h.html#a10">00994</a> <span class="keywordtype">void</span> *<a class="code" href="iddcm_8h.html#a10">IdDcmReadFile</a>(<span class="keywordtype">char</span> * filename, <span class="keywordtype">int</span> type) {
00995 <span class="keywordtype">void</span> ** tabObj=NULL;
00996 
00997     <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"----------------------------entree ds  IdDcmReadFile\n"</span>);
00998 
00999 tabObj=<a class="code" href="iddcm_8h.html#a14">IdDcmReadFileIntoVector</a>(filename, type,-2, -2, NULL);
01000 
01001 <span class="keywordflow">if</span> (tabObj==NULL) 
01002    <span class="keywordflow">return</span> (NULL);
01003 <span class="keywordflow">else</span>
01004    <span class="keywordflow">return</span>(tabObj[0]);
01005 }
01006 
01007 
01008 <span class="comment">/* ----------------------------------------------------------------------- */</span>
<a name="l01018"></a><a class="code" href="iddcm_8h.html#a11">01018</a> <span class="keywordtype">void</span> *<a class="code" href="iddcm_8h.html#a11">IdDcmReadFileFromDcmHdr</a>(<a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> *e, <span class="keywordtype">int</span> type) {
01019 <span class="keywordtype">void</span> ** tabObj=NULL;
01020 
01021     <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"----------------------------entree ds  IdDcmReadFileFromDcmHdr\n"</span>);
01022 
01023 tabObj=<a class="code" href="iddcm_8h.html#a15">IdDcmReadFileIntoVectorFromDcmHdr</a>(e, type,-2, -2, NULL);
01024 
01025 <span class="keywordflow">if</span> (tabObj==NULL) 
01026    <span class="keywordflow">return</span> (NULL);
01027 <span class="keywordflow">else</span>
01028    <span class="keywordflow">return</span>(tabObj[0]);
01029 }
01030 
01031 <span class="comment">//-------------------------------------------------------------------------</span>
01032 <span class="comment">//</span>
01033 <span class="comment">// IdDcmMultiFrameReadFile est une encapsulation de IdDcmReadFileIntoVector</span>
01034 <span class="comment">//</span>
01035 
<a name="l01052"></a><a class="code" href="iddcm_8h.html#a12">01052</a> <span class="keywordtype">void</span> *<a class="code" href="iddcm_8h.html#a12">IdDcmMultiFrameReadFile</a>(<span class="keywordtype">char</span> * filename, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> numPremIm, <span class="keywordtype">int</span> numDernIm) {
01053 <span class="keywordtype">void</span> ** tabObj=NULL;
01054 
01055     <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"----------------------------entree ds  IdDcmMultiFrameReadFile\n"</span>);
01056 
01057 tabObj=<a class="code" href="iddcm_8h.html#a14">IdDcmReadFileIntoVector</a>(filename,type, numPremIm, numDernIm, NULL);
01058 
01059 <span class="keywordflow">if</span> (tabObj==NULL) 
01060    <span class="keywordflow">return</span> (NULL);
01061 <span class="keywordflow">else</span>
01062    <span class="keywordflow">return</span>(tabObj[0]);
01063 }
01064 
01065 <span class="comment">// -------------------------------------------------------------------------------</span>
01066 
<a name="l01067"></a><a class="code" href="iddcm_8h.html#a13">01067</a> <span class="keywordtype">void</span> *<a class="code" href="iddcm_8h.html#a13">IdDcmMultiFrameReadFileFromDcmHdr</a>(<a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> *e, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> numPremIm, <span class="keywordtype">int</span> numDernIm) {
01068 <span class="keywordtype">void</span> ** tabObj=NULL;
01069 
01070     <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"----------------------------entree ds  IdDcmMultiFrameReadFileFromDcmHdr\n"</span>);
01071 
01072 tabObj=<a class="code" href="iddcm_8h.html#a15">IdDcmReadFileIntoVectorFromDcmHdr</a>(e,type, numPremIm, numDernIm, NULL);
01073 
01074 <span class="keywordflow">if</span> (tabObj==NULL) 
01075    <span class="keywordflow">return</span> (NULL);
01076 <span class="keywordflow">else</span>
01077    <span class="keywordflow">return</span>(tabObj[0]);
01078 }
01079 
01080 
01081 <span class="comment">/* ------------------------------------------------------------------------------------ */</span>
01082 
<a name="l01083"></a><a class="code" href="iddcm_8h.html#a6">01083</a> <span class="keywordtype">int</span> <a class="code" href="iddcm_8h.html#a6">IdDcmIsAcrLibido</a>(<a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> *e) {
01084 
01085    <span class="keywordflow">return</span>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a>);
01086 }
01087 
01088 
01089 
01090 <span class="comment">// ------------------------------------------------------------------------------------</span>
01091 
01092 
<a name="l01104"></a><a class="code" href="iddcm-restricted_8h.html#a1">01104</a> <span class="keywordtype">char</span> * <a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(<span class="keywordtype">int</span> gr, <span class="keywordtype">int</span> num, <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a>  *e) {
01105 
01106 <a class="code" href="struct__ID__DCM__ELEM.html">_ID_DCM_ELEM</a> *ple;   
01107 <a class="code" href="struct__elem.html">PLIST_ELEMENT</a> plelem; 
01108 plelem = <a class="code" href="idliste_8h.html#a17">IdLstFirst</a>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o19">plist</a>);
01109 
01110 <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  printf(<span class="stringliteral">"\t\t\t\t\trecherche (1) gr %x  num %x\n"</span>,gr,num); 
01111 
01112    <span class="keywordflow">while</span>(plelem) {
01113       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01114 
01115       <span class="keywordflow">if</span> (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> == gr) <span class="keywordflow">break</span>;
01116       <span class="keywordflow">if</span> (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> &gt; gr) {
01117          <span class="keywordflow">return</span>(NULL);
01118       }
01119       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01120    }
01121    <span class="keywordflow">while</span>(plelem) {
01122       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01123 
01124       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> == num) <span class="keywordflow">break</span>;
01125       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> &gt; num) {
01126          <span class="keywordflow">return</span>(NULL);
01127       }
01128       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01129    }
01130    
01131    <span class="keywordflow">return</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o9">valeurElem</a>);
01132 }
01133 
01134 <span class="comment">// ------------------------------------------------------------------------------------</span>
01135 
01136 
01137 <span class="comment">// ------------------------------------------------------------------------------------</span>
01138 
01139 
<a name="l01153"></a><a class="code" href="iddcm-restricted_8h.html#a2">01153</a> <span class="keywordtype">char</span> * <a class="code" href="iddcm-restricted_8h.html#a2">_IdDcmReadElementNoSQ</a>(<span class="keywordtype">int</span> gr, <span class="keywordtype">int</span> num, <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a>  *e) {
01154 
01155 <a class="code" href="struct__ID__DCM__ELEM.html">_ID_DCM_ELEM</a> *ple;   
01156 <a class="code" href="struct__elem.html">PLIST_ELEMENT</a> plelem; 
01157 <span class="keywordtype">int</span> trouve = 0;
01158 
01159 plelem = <a class="code" href="idliste_8h.html#a17">IdLstFirst</a>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o19">plist</a>);
01160 
01161 <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  printf(<span class="stringliteral">"\t\t\t\t\trecherche IdDcmReadElementNoSQ (1) gr %x  num %x\n"</span>,gr,num); 
01162 
01163    <span class="keywordflow">while</span>(plelem) {
01164       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01165 
01166       <span class="keywordflow">if</span> (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> == gr) {
01167          trouve =1;
01168          <span class="keywordflow">break</span>;
01169       }
01170       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01171    }
01172    
01173    <span class="keywordflow">if</span> (trouve ==0) <span class="keywordflow">return</span> (NULL);
01174    
01175    trouve = 0;
01176    
01177    <span class="keywordflow">while</span>(plelem) {
01178       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01179 
01180       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> == num)  {
01181          trouve =1;
01182          <span class="keywordflow">break</span>;
01183       }
01184       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01185    }
01186    
01187    <span class="keywordflow">if</span> (trouve ==0) {
01188       <span class="keywordflow">return</span> (NULL);
01189     } <span class="keywordflow">else</span> {
01190       <span class="keywordflow">return</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o9">valeurElem</a>);
01191    }
01192 }
01193 
01194 <span class="comment">// ------------------------------------------------------------------------------------</span>
01195 
<a name="l01207"></a><a class="code" href="iddcm-restricted_8h.html#a0">01207</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(<span class="keywordtype">int</span> gr, <span class="keywordtype">int</span> num, <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a>  *e) {
01208 
01209 <a class="code" href="struct__ID__DCM__ELEM.html">_ID_DCM_ELEM</a> *ple;
01210 <a class="code" href="struct__elem.html">PLIST_ELEMENT</a> plelem; 
01211 
01212 <span class="keywordflow">if</span>(!e) {
01213    printf(<span class="stringliteral">"DCM_HDR non alloué\n"</span>);
01214    <span class="keywordflow">return</span>(0xFFFF);
01215 }
01216 
01217 plelem = <a class="code" href="idliste_8h.html#a17">IdLstFirst</a>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o19">plist</a>);
01218 <span class="keywordflow">if</span> (!plelem) {
01219    printf(<span class="stringliteral">"ID_DCM_HDR : Liste vide\n"</span>);
01220    <span class="keywordflow">return</span>(0xFFFF);
01221 }
01222    
01223 <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  printf(<span class="stringliteral">"\t\t\t_IdDcmReadElementUSHORT\t\trecherche (1) gr %x  num %x\n"</span>,gr,num); 
01224 
01225    <span class="keywordflow">while</span>(plelem) {
01226       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01227       
01228       <span class="comment">//if (DEBUG) printf(" on est sur gr %04x \n",ple-&gt;Gr);</span>
01229 
01230       <span class="keywordflow">if</span> (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> == gr) <span class="keywordflow">break</span>;
01231       <span class="keywordflow">if</span> ( (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> &gt;  gr) &amp;&amp; (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> !=0xFFFE) ) {
01232          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">" gr %04x trouve\n"</span>,ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a>);
01233          <span class="keywordflow">return</span>(0xFFFF);
01234       }
01235       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01236    }
01237    
01238    <span class="keywordflow">while</span>(plelem) {
01239       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01240       
01241       <span class="comment">//if (DEBUG) printf(" on est sur num %04x \n",ple-&gt;Num);</span>
01242    
01243       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> == num) <span class="keywordflow">break</span>;
01244       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> &gt;  num) {
01245          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">" num %04x trouve\n"</span>,ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a>);
01246          <span class="keywordflow">return</span>(0xFFFF);
01247       }
01248       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01249    }
01250                                  <span class="comment">// POURQUOI ple-&gt;valShort N'EST PAS INITIALISE?</span>
01251    <span class="keywordflow">return</span> (<a class="code" href="iddcm_8h.html#a0">str2num</a>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o9">valeurElem</a>,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>));
01252 }
01253 
01254 
01255 
<a name="l01256"></a><a class="code" href="iddcm-restricted_8h.html#a4">01256</a> <span class="keywordtype">int</span> <a class="code" href="iddcm-restricted_8h.html#a4">_IdDcmGetElementLength</a>(<span class="keywordtype">int</span> gr, <span class="keywordtype">int</span> num, <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a>  *e) {
01257 
01258 <a class="code" href="struct__ID__DCM__ELEM.html">_ID_DCM_ELEM</a> *ple;
01259 <a class="code" href="struct__elem.html">PLIST_ELEMENT</a> plelem; 
01260 
01261 plelem = <a class="code" href="idliste_8h.html#a17">IdLstFirst</a>(e-&gt;<a class="code" href="structID__DCM__HDR.html#o19">plist</a>);
01262 
01263 <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  printf(<span class="stringliteral">"\t\t\t\t\trecherche Lgr(1) gr %x  num %x\n"</span>,gr,num); 
01264 
01265    <span class="keywordflow">while</span>(plelem) {
01266       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01267 
01268       <span class="keywordflow">if</span> (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> == gr) <span class="keywordflow">break</span>;
01269       <span class="keywordflow">if</span> ( (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> &gt;  gr) &amp;&amp; (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a> !=0xFFFE) ) {
01270          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">" gr %04x trouve\n"</span>,ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o0">Gr</a>);
01271          <span class="comment">//return(0xFFFFFFFF);</span>
01272          <span class="keywordflow">return</span>(0);
01273       }
01274       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01275    }
01276    
01277    <span class="keywordflow">while</span>(plelem) {
01278       ple= <a class="code" href="idliste_8h.html#a22">IdLstPtrObj</a>(plelem);  <span class="comment">// le _ID_DCM_ELEM  pointé par le PLIST_ELEMENT</span>
01279    
01280       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> == num) <span class="keywordflow">break</span>;
01281       <span class="keywordflow">if</span>(ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a> &gt;  num) {
01282          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">" num %04x trouve\n"</span>,ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o1">Num</a>);
01283          <span class="comment">//return(0xFFFFFFFF);</span>
01284          <span class="keywordflow">return</span>(0);
01285       }
01286       plelem = <a class="code" href="idliste_8h.html#a20">IdLstNext</a>(plelem);
01287    }
01288    <span class="keywordflow">return</span> (ple-&gt;<a class="code" href="struct__ID__DCM__ELEM.html#o3">LgrElem</a>);
01289 }
01290 
01291 
01292 <span class="comment">/* </span>
01293 <span class="comment">* ------------------------------------------------------------------------------------------------------ </span>
01294 <span class="comment">*/</span>
01295 
01296 <span class="comment">/* ------------------------------------------------------------ */</span>
01297 <span class="comment">/* A partir d'un fichier Acr deja ouvert,          */</span>
01298 <span class="comment">/* ds lequel on deja lu bufbid (8,10)           */</span>
01299 <span class="comment">/*                et ty (signe : ( 28,103)         */</span>
01300 <span class="comment">/* on cherche le type stocke  ( 28,105 ou 28,199 )    */</span>
01301 <span class="comment">/*         ou le type deduit  ( a partir de nb et de ty )   */</span>
01302 <span class="comment">/*                      */</span>
01303 <span class="comment">/*    retourne -1 si rien trouve ou rien deduit       */</span>
01304 <span class="comment">/* ------------------------------------------------------------ */</span>
01305 
<a name="l01306"></a><a class="code" href="iddcm-restricted_8h.html#a5">01306</a> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code" href="iddcm-restricted_8h.html#a5">_IdDcmCheckType</a>(<a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a>  *e, <span class="keywordtype">int</span> ity, <span class="keywordtype">int</span> inb, <span class="keywordtype">int</span> itypObj, <span class="keywordtype">int</span> SamplesPerPixel)
01307 {
01308 <span class="keywordtype">long</span> <span class="keywordtype">int</span> lgrMessage;
01309 <span class="keywordtype">short</span> <span class="keywordtype">int</span> typ;
01310 <span class="keywordtype">short</span> <span class="keywordtype">int</span> ty=ity;
01311 <span class="keywordtype">short</span> <span class="keywordtype">int</span> nb=inb;
01312 <span class="keywordtype">short</span> <span class="keywordtype">int</span> typObj=itypObj;
01313 <span class="keywordtype">char</span> * bufbid;
01314 
01315    <span class="keywordflow">if</span> (nb==12) nb=8; 
01316    
01317 <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"ACR LIBIDO %d\n"</span>,e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a>); 
01318    typ= -1;
01319    <span class="keywordflow">if</span> (  e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a> ) {
01320       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"IdDcmCheckType : on a trouve ACR LIBIDO\n"</span>); 
01321       bufbid=<a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(0x0028,0x0199,e);<span class="comment">/* on cherche 28,199 (LibIDO type)*/</span>
01322       <span class="keywordflow">if</span> (!bufbid) 
01323          typ=-1;
01324       <span class="keywordflow">else</span> {
01325          typ=<a class="code" href="iddcm_8h.html#a0">str2num</a>(bufbid, <span class="keywordtype">short</span> <span class="keywordtype">int</span>);
01326             <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  printf (<span class="stringliteral">"IdDcmCheckType : type lu sur disque %x\n"</span>,typ); 
01327          }
01328    }
01329 
01330    <span class="keywordflow">if</span> (typ==-1) {      <span class="comment">/* on n a rien trouve                */</span>
01331                <span class="comment">/* (ce n'EST PAS un fichier ACR-LibIDO nouvelle version)  */</span>
01332                             <span class="comment">/* debut usine a gaz    */</span>
01333                             
01334                <span class="keywordflow">if</span> (SamplesPerPixel == 3) nb=24;
01335                             
01336               <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a52">TA_TY_UCHAR</a>*8) &amp;&amp; (ty==0))typ = typObj | <a class="code" href="idgen_8h.html#a26">TY_UCHAR</a>; 
01337       <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a51">TA_TY_CHAR</a>*8)  &amp;&amp; (ty==1))typ = typObj | <a class="code" href="idgen_8h.html#a19">TY_CHAR</a>;
01338       <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a59">TA_TY_USHORT</a>*8)&amp;&amp; (ty==0))typ = typObj | <a class="code" href="idgen_8h.html#a27">TY_USHORT</a>;
01339       <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a58">TA_TY_SHORT</a>*8) &amp;&amp; (ty==1))typ = typObj | <a class="code" href="idgen_8h.html#a24">TY_SHORT</a>;
01340       <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a61">TA_TY_ULONG</a>*8) &amp;&amp; (ty==0))typ = typObj | <a class="code" href="idgen_8h.html#a39">TY_ULONG</a>;
01341       <span class="keywordflow">else</span> <span class="keywordflow">if</span>((nb==<a class="code" href="idgen_8h.html#a60">TA_TY_LONG</a>*8)  &amp;&amp; (ty==1))typ = typObj | <a class="code" href="idgen_8h.html#a25">TY_LONG</a>;
01342    
01343        
01344 
01345       <span class="comment">//   ATTENTION : les representations internes des types FLOAT et DOUBLE</span>
01346       <span class="comment">//   sont machine-dependent</span>
01347    
01348             <span class="comment">//les anciens float et doubles n etaient pas signes.... */</span>
01349 
01350       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==<a class="code" href="idgen_8h.html#a53">TA_TY_FLOAT</a>*8)  )           typ = typObj | <a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>;
01351       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==<a class="code" href="idgen_8h.html#a54">TA_TY_DOUBLE</a>*8) )           typ = typObj | <a class="code" href="idgen_8h.html#a21">TY_DOUBLE</a>; 
01352          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==3*<a class="code" href="idgen_8h.html#a52">TA_TY_UCHAR</a>*8)&amp;&amp;(ty==0))  typ = typObj | <a class="code" href="idgen_8h.html#a23">TY_RGB</a>;
01353       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((nb==<a class="code" href="idgen_8h.html#a62">TA_TY_COMPLEX_DOUBLE</a>*8))    typ = typObj | <a class="code" href="idgen_8h.html#a28">TY_COMPLEX_DOUBLE</a>;
01354       
01355       printf(<span class="stringliteral">"typ %x\n"</span>,typ);
01356       
01357 
01358       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)  printf (<span class="stringliteral">"IdDcmCheckType : Entete : nb=%d typObj=%x; Type deduit=%x\n"</span>,
01359             nb,typObj,typ);  
01360 
01361       <span class="comment">/* ce N'EST PAS un fichier LibIDO   */</span>
01362 
01363       e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>=(<span class="keywordtype">char</span> *)malloc(10); <span class="comment">/* pour eviter des soucis ulterieurs */</span>
01364       lgrMessage=0;
01365             
01366    } <span class="keywordflow">else</span> {    <span class="comment">/* fin usine a gaz    */</span>
01367  
01368       <span class="comment">/* C'EST un fichier LibIDO */</span>
01369       <span class="comment">/* on regarde si 'message' (28,198)contient qq chose */</span>
01370       lgrMessage= <a class="code" href="iddcm-restricted_8h.html#a4">_IdDcmGetElementLength</a>(0x0028,0x0198,e);
01371       
01372       <span class="keywordflow">if</span> (lgrMessage !=0) { 
01373          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"lgrMessage %ld\n"</span>, lgrMessage);  
01374          e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>=(<span class="keywordtype">char</span> *)malloc(lgrMessage+1);
01375          <span class="keywordflow">if</span> (!e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>) {
01376             printf(<span class="stringliteral">"Echec alloc _message (lgr %d)\n"</span>,lgrMessage);
01377             e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>=(<span class="keywordtype">char</span> *)malloc(10); <span class="comment">/* pour eviter des soucis ulterieurs */</span>
01378          } <span class="keywordflow">else</span>
01379 
01380                e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>=<a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(0x0028,0x0198,e);
01381       }
01382       <span class="keywordflow">else</span>
01383          e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>=(<span class="keywordtype">char</span> *)malloc(10); <span class="comment">/* pour eviter des soucis ulterieurs */</span>
01384    }
01385    e-&gt;<a class="code" href="structID__DCM__HDR.html#o4">_message</a>[lgrMessage]=<span class="charliteral">'\0'</span>;
01386    <span class="keywordflow">return</span> typ;
01387 }
01388 
01389 
01390 <span class="comment">//-------------------------------------------------------------------------------------------</span>
01391 
<a name="l01418"></a><a class="code" href="iddcm_8h.html#a21">01418</a> <span class="keywordtype">int</span> <a class="code" href="iddcm_8h.html#a21">IdDcmInquireInfoFromFile</a> ( <span class="keywordtype">char</span> * filename,
01419          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj,
01420          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typLibido,
01421          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData,
01422          <span class="keywordtype">int</span> *NX, 
01423          <span class="keywordtype">int</span> *NY, 
01424          <span class="keywordtype">int</span> *NZ, 
01425          <span class="keywordtype">int</span> *NT,
01426          <span class="keywordtype">int</span> *offset,
01427          <span class="keywordtype">int</span> *nbFrames,
01428          <span class="keywordtype">int</span> *codeSwap, 
01429          <span class="keywordtype">int</span> *bitsAllocated,
01430          <span class="keywordtype">int</span> *bitsStored,
01431          <span class="keywordtype">int</span> *highBit,
01432          <span class="keywordtype">int</span> *signe)
01433 {
01434   <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> *e;
01435   <span class="keywordtype">int</span> i;
01436          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"entree ds IdDcmInquireInfoFromFile\n"</span>);
01437 
01438    <span class="keywordflow">if</span>((e=<a class="code" href="iddcm_8h.html#a5">IdDcmGetHeader</a>(filename))==0) {
01439       printf (<span class="stringliteral">"Gros soucis sur : %s\n"</span>,filename);
01440       <span class="keywordflow">return</span> (0);
01441         }
01442          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"sortie de IdDcmGetHeader\n"</span>);
01443          
01444         i = <a class="code" href="iddcm_8h.html#a22">IdDcmInquireInfoFromDcmHdr</a> (e,
01445                typObj,
01446                typLibido,
01447                typData,
01448                NX, 
01449                NY, 
01450                NZ, 
01451                NT,
01452                offset,
01453                nbFrames,
01454                codeSwap, 
01455                bitsAllocated,
01456                bitsStored,
01457                highBit,
01458                signe);
01459                
01460    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"sortie de IdDcmInquireInfoFromDcmHdr\n"</span>);
01461 
01462    <a class="code" href="iddcm_8h.html#a4">IdDcmHdrFree</a>(e);
01463    <span class="keywordflow">return</span> (i);
01464    
01465  }
01466  
01467  
01468 <span class="comment">//-------------------------------------------------------------------------------------------</span>
01469 
<a name="l01501"></a><a class="code" href="iddcm_8h.html#a22">01501</a> <span class="keywordtype">int</span> <a class="code" href="iddcm_8h.html#a22">IdDcmInquireInfoFromDcmHdr</a> ( <a class="code" href="structID__DCM__HDR.html">ID_DCM_HDR</a> * e,
01502          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typObj,
01503          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typLibido,
01504          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> *typData,
01505          <span class="keywordtype">int</span> *NX, 
01506          <span class="keywordtype">int</span> *NY, 
01507          <span class="keywordtype">int</span> *NZ, 
01508          <span class="keywordtype">int</span> *NT,
01509          <span class="keywordtype">int</span> *offset,
01510          <span class="keywordtype">int</span> *nbFrames,
01511          <span class="keywordtype">int</span> *codeSwap, 
01512          <span class="keywordtype">int</span> *bitsAllocated,
01513          <span class="keywordtype">int</span> *bitsStored,
01514          <span class="keywordtype">int</span> *highBit,
01515          <span class="keywordtype">int</span> *signe)
01516 {
01517   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> ndim;
01518   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> dim[4];
01519   <span class="keywordtype">int</span> i, SamplesPerPixel;
01520   <span class="keywordtype">char</span> *bufbid;
01521       
01522    e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a> = <a class="code" href="iddcm_8h.html#a6">IdDcmIsAcrLibido</a>(e);
01523 
01524    bufbid=<a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(0x0028,0x0004,e);
01525 
01526    <span class="keywordflow">if</span>(bufbid!=NULL) {         <span class="comment">// RGB</span>
01527       <span class="keywordflow">if</span> (  (memcmp(bufbid,<span class="stringliteral">"RGB "</span>,4)==0)    
01528             ||
01529                   (memcmp(bufbid,<span class="stringliteral">"B RG"</span>,4)==0) 
01530             ||
01531                   (memcmp(bufbid,<span class="stringliteral">" BGR"</span>,4)==0)          
01532             ||
01533                   (memcmp(bufbid,<span class="stringliteral">"GR B"</span>,4)==0)) {
01534 
01535          <span class="comment">// rgb=1; // Mais elle servait a QUOI tout court ??</span>
01536 
01537          printf (<span class="stringliteral">"Image RGB  -&gt;%s&lt;-\n"</span>, bufbid);
01538       }
01539    }
01540 
01541    <span class="keywordflow">if</span>((ndim=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0005,e))==0xFFFF) {
01542       ndim=2;  <span class="comment">// nb de dim de l'objet (IMA par defaut)</span>
01543    }
01544 
01545    <span class="keywordflow">if</span> ((ndim&gt;4)||(ndim&lt;1)) {
01546       printf (<span class="stringliteral">"nb de dim = %d, errone\n"</span>,ndim);
01547       <span class="keywordflow">return</span>(0);
01548    } <span class="keywordflow">else</span> {
01549       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01550          printf (<span class="stringliteral">"\t\t\t ndim (0x0028,0x0005) : %d\n"</span>,ndim);
01551       }
01552    }
01553    
01554    <span class="comment">// Lecture SamplesPerPixel (1 : Gray Scale, 3 : RGB)</span>
01555    
01556    <span class="keywordflow">if</span>((SamplesPerPixel=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0002,e))==0xFFFF) {
01557       SamplesPerPixel=1;   <span class="comment">// (Gray Scale par defaut)</span>
01558    }  
01559 
01560    <span class="comment">// Lecture nbFrames </span>
01561       
01562    <span class="keywordflow">if</span>(!(bufbid=<a class="code" href="iddcm-restricted_8h.html#a1">_IdDcmReadElement</a>(0x0028,0x0008,e))) {
01563       *nbFrames=1; <span class="comment">// mono-frame par defaut</span>
01564    } <span class="keywordflow">else</span> {
01565       *nbFrames=atoi(bufbid);
01566       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>)
01567          printf (<span class="stringliteral">"\t\t\t nbFrames (0x0028,0x0008) : %d\n"</span>,*nbFrames);
01568    }
01569 
01570    <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
01571       <span class="keywordflow">if</span>((dim[i]=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0010+i,e))==0xFFFF) { 
01572          <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
01573          printf (<span class="stringliteral">"IdDcmInquireInfoFromDcmHdr : fichier non ACR (0x0028,0x00%d) "</span>
01574             <span class="stringliteral">"missing\n"</span>,10+i);
01575          <span class="keywordflow">return</span> (0);
01576       }  <span class="keywordflow">else</span> {
01577          <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) 
01578             printf (<span class="stringliteral">"\t\t\t dim (0x0028,0x001?) : dim[%d]=%d\n"</span>,i,dim[i]);
01579       }
01580 
01581 
01582    <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structID__DCM__HDR.html#o7">ACR_LIBIDO</a>!=1) {
01583    <span class="comment">// si c'est une VRAIE image ACR</span>
01584    <span class="comment">// on permutte NX et NY ds l'entete LibIDO</span>
01585       <span class="keywordtype">int</span> secuDim;
01586       secuDim = dim[0];
01587       dim[0]  = dim[1];
01588       dim[1]  = secuDim;
01589    }
01590 
01591    *NT = *NZ = *NY = *NX = 1;
01592    
01593    <span class="keywordflow">switch</span>(ndim) {
01594       <span class="keywordflow">case</span> 4: *NT=dim[3];
01595       <span class="keywordflow">case</span> 3: *NZ=dim[2];
01596       <span class="keywordflow">case</span> 2: *NY=dim[1];
01597       <span class="keywordflow">case</span> 1: *NX=dim[0];
01598     } 
01599 
01600    <span class="keywordflow">switch</span> (ndim) {
01601             <span class="keywordflow">case</span>  1: *typObj=<a class="code" href="idgen_8h.html#a11">SIG</a>; <span class="keywordflow">break</span>;
01602             <span class="keywordflow">case</span>  2: *typObj=<a class="code" href="idgen_8h.html#a7">IMA</a>; <span class="keywordflow">break</span>;
01603             <span class="keywordflow">case</span>  3: *typObj=<a class="code" href="idgen_8h.html#a10">VOL</a>; <span class="keywordflow">break</span>;
01604             <span class="keywordflow">case</span>  4: *typObj=<a class="code" href="idgen_8h.html#a9">SEQ</a>; <span class="keywordflow">break</span>;
01605             <span class="keywordflow">default</span>: {
01606          <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
01607          <span class="keywordflow">return</span> (0);
01608             }
01609    }
01610    
01611    <span class="keywordflow">if</span>((*bitsAllocated=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0100,e))==0xFFFF) { 
01612       *bitsAllocated=16 ;      <span class="comment">// nb bits allocated</span>
01613       } <span class="keywordflow">else</span> {
01614       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01615          printf (<span class="stringliteral">"\t\t\t nb (0x0028,0x0100) : %d\n"</span>,*bitsAllocated);
01616       }
01617    }
01618 
01619    <span class="keywordflow">if</span>((*bitsStored=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0101,e))==0xFFFF) { 
01620       *bitsStored = *bitsAllocated ;   <span class="comment">// nb bits utiles</span>
01621    } <span class="keywordflow">else</span> {
01622       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01623          printf (<span class="stringliteral">"\t\t\t nbu (0x0028,0x0101) : %d\n"</span>,*bitsStored);
01624       }
01625         }
01626 
01627    <span class="keywordflow">if</span>((*highBit=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0102,e))==0xFFFF) {
01628       <span class="comment">// hight bit pas pris en compte</span>
01629       *highBit = *bitsStored-1 ;
01630    } <span class="keywordflow">else</span> {
01631       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01632          printf (<span class="stringliteral">"\t\t\t highBit (0x0028,0x0102) : %d\n"</span>,*highBit);
01633       }
01634         }
01635          
01636    <span class="keywordflow">if</span>((*signe=<a class="code" href="iddcm-restricted_8h.html#a0">_IdDcmReadElementUSHORT</a>(0x0028,0x0103,e))==0xFFFF) { <span class="comment">// signe o/n</span>
01637       <a class="code" href="iderr_8h.html#a65">IdErrno</a>=<a class="code" href="iderr_8h.html#a25">IDERR_NON_ACR_FILE</a>;
01638       printf (<span class="stringliteral">"fichier non ACR (0x0028,0x0103) missing\n"</span>);
01639       <span class="keywordflow">return</span> (0);
01640    } <span class="keywordflow">else</span> {
01641       <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01642          printf (<span class="stringliteral">"\t\t\t signe (0x0028,0x0103) : %d\n"</span>,*signe);
01643            }
01644    }
01645 
01646    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01647       printf(<span class="stringliteral">"nbit alloues=%d nbit Utiles=%d highbit %d signe=%d\n"</span>,
01648           *bitsAllocated,*bitsStored,*highBit,*signe);
01649       <span class="keywordflow">for</span>(i=0;i&lt;ndim;i++)
01650          printf(<span class="stringliteral">" dim[%d]= %d; "</span>, i, dim[i]);
01651       printf (<span class="stringliteral">"\n"</span>);
01652    }   
01653 <span class="comment">/*</span>
01654 <span class="comment">    if (*typData != TY_RGB) {</span>
01655 <span class="comment">      *typData=_IdAcrCheckType(fp, bufbid, (int)ty, (int)nb, *typObj);</span>
01656 <span class="comment">      </span>
01657 <span class="comment">    }</span>
01658 <span class="comment">    *typLibido = *typData &amp; TY_SIZE;</span>
01659 <span class="comment">*/</span> 
01660    
01661     *typLibido=<a class="code" href="iddcm-restricted_8h.html#a5">_IdDcmCheckType</a>(e,*signe,*bitsAllocated,*typObj, SamplesPerPixel); 
01662     *typData = *typLibido &amp; <a class="code" href="idgen_8h.html#a18">TY_SIZE</a>;
01663     
01664     
01665     *offset  = e-&gt;<a class="code" href="structID__DCM__HDR.html#o14">PixelPosition</a>;
01666     
01667    <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) {
01668       printf(<span class="stringliteral">"PixelPosition %d\n"</span>, e-&gt;<a class="code" href="structID__DCM__HDR.html#o14">PixelPosition</a>); 
01669    } 
01670     
01671    *codeSwap = e-&gt;<a class="code" href="structID__DCM__HDR.html#o5">sw</a>; 
01672 
01673   <span class="keywordflow">return</span> 1;
01674 }
01675 
01676 
01677 
01678 <span class="keyword">static</span> <span class="keywordtype">void</span> _Swap(<span class="keywordtype">void</span>* im, <span class="keywordtype">int</span> swap, <span class="keywordtype">int</span> lgr, <span class="keywordtype">int</span> type) {                     
01679 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> s32, i;
01680 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> fort,faible;
01681 
01682 <span class="keywordflow">if</span> (<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf (<span class="stringliteral">"Entree ds _Swap codeSwap %d,  lgr %d\n"</span>,swap, lgr);
01683 
01684 <span class="keywordflow">if</span>((type==<a class="code" href="idgen_8h.html#a24">TY_SHORT</a>)||(type==<a class="code" href="idgen_8h.html#a27">TY_USHORT</a>))
01685     
01686    <span class="keywordflow">switch</span>(swap) {
01687       <span class="keywordflow">case</span> 0:
01688       <span class="keywordflow">case</span> 12:
01689       <span class="keywordflow">case</span> 1234:
01690          <span class="keywordflow">break</span>;
01691       
01692       <span class="keywordflow">case</span> 21:
01693       <span class="keywordflow">case</span> 3412:
01694       <span class="keywordflow">case</span> 2143:
01695       <span class="keywordflow">case</span> 4321:
01696 
01697          <span class="keywordflow">for</span>(i=0;i&lt;lgr;i++)
01698             ((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>*)im)[i]= ((((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>*)im)[i])&gt;&gt;8)
01699                                     | ((((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>*)im)[i])&lt;&lt;8);
01700          <span class="keywordflow">break</span>;
01701          
01702       <span class="keywordflow">default</span>:
01703          printf(<span class="stringliteral">"valeur de SWAP (16 bits)non autorisee : %d\n"</span>, swap);
01704    } 
01705  
01706 <span class="keywordflow">if</span>( (type==<a class="code" href="idgen_8h.html#a25">TY_LONG</a>)||(type==<a class="code" href="idgen_8h.html#a39">TY_ULONG</a>)||(type==<a class="code" href="idgen_8h.html#a20">TY_FLOAT</a>)  )
01707 
01708    <span class="keywordflow">switch</span> (swap) {
01709          <span class="keywordflow">case</span> 0:
01710          <span class="keywordflow">case</span> 1234:
01711              <span class="keywordflow">break</span>;
01712 
01713          <span class="keywordflow">case</span> 4321:
01714              <span class="keywordflow">for</span>(i=0;i&lt;lgr;i++) {
01715                faible=  ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]&amp;0x0000ffff;    <span class="comment">/* 4321 */</span>
01716                   fort  =((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]&gt;&gt;16;
01717                fort=  (fort&gt;&gt;8)   | (fort&lt;&lt;8);
01718                faible=(faible&gt;&gt;8) | (faible&lt;&lt;8);
01719                s32=faible;
01720                ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]=(s32&lt;&lt;16)|fort;
01721                }
01722             <span class="keywordflow">break</span>;
01723 
01724          <span class="keywordflow">case</span> 2143:
01725             <span class="keywordflow">for</span>(i=0;i&lt;lgr;i++) {
01726                   faible=  ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]&amp;0x0000ffff;    <span class="comment">/* 2143 */</span>
01727                   fort=((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]&gt;&gt;16;
01728                   fort=  (fort&gt;&gt;8)   | (fort&lt;&lt;8);
01729                   faible=(faible&gt;&gt;8) | (faible&lt;&lt;8);
01730                   s32=fort; 
01731                   ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]=(s32&lt;&lt;16)|faible;
01732                }
01733             <span class="keywordflow">break</span>;
01734   
01735          <span class="keywordflow">case</span> 3412:
01736             <span class="keywordflow">for</span>(i=0;i&lt;lgr;i++) {
01737                   faible=  ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]&amp;0x0000ffff;    <span class="comment">/* 3412 */</span>
01738                   fort=((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]&gt;&gt;16;                  
01739                   s32=faible; 
01740                   ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>*)im)[i]=(s32&lt;&lt;16)|fort;
01741                }                 
01742             <span class="keywordflow">break</span>; 
01743                     
01744          <span class="keywordflow">default</span>:
01745             printf(<span class="stringliteral">"valeur de SWAP (32 bits) non autorisee : %d\n"</span>, swap);
01746    } 
01747 <span class="keywordflow">if</span>(<a class="code" href="acrwrite_8c.html#a0">DEBUG</a>) printf(<span class="stringliteral">"sortie _Swap\n"</span>); 
01748 <span class="keywordflow">return</span>;
01749 }
01750 
01751 
01752 
01753 
01754 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 20 14:28:13 2006 for SIMRI3D by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
